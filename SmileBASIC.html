<html>
	<head>
		<title>SmileBASIC</title>
		<link rel="icon" type="image/png" sizes="16x16" href="./resources/SBicon.png">
		<link rel="stylesheet" href="./main.css"</link>
		<style>
			textarea {
				margin: 0;
				border: 0;
				padding: 0;
				height: 240px;
				width: 400px;
				font-size: 8px;
				line-height: 8px;
				background-color: #111;
				color: #FFF;
				font-family: "SmileBASIC", monospace;
				overflow: hidden;  
				resize: none;
				outline: none;
				pointer-events: none;
			}
		</style>
		<script>

document.addEventListener('keydown', function(e){



if(e.keyCode == 38 || e.keyCode == 40 || e.keyCode == 34 || e.keyCode == 33)
 e.preventDefault();

var textarea = document.getElementsByTagName("textarea")[0];
if (textarea.selectionStart < textarea.value.lastIndexOf("\n",textarea.value.length)+2) {
textarea.selectionStart=textarea.value.lastIndexOf("\n",textarea.value.length)+2;
}


});

			document.addEventListener('DOMContentLoaded', function() {
				var textarea = document.getElementsByTagName("textarea")[0];
				textarea.value = "SMILEBASIC ver -0.3.2\n(C)2011-2015 SmileBoom Co.Ltd.\n9150922752 bytes free\n";
				setCursor(textarea,textarea.value.length);
			}, false);
			
			function readLine() {
				var textarea = document.getElementsByTagName("textarea")[0];
				var lastline = textarea.value.split("\n")[textarea.value.split("\n").length - 2];
				if (checkCommand(lastline,"BGMPLAY")) {
					var command = parseInt(lastline.split(" ")[lastline.split(" ").length -1]);
					var songnum=" ";
					if (command>=0 && command<=9) {
						songnum=" "+command;
					} else {
						songnum=command;
					}
					if (command>=0 && command <=42) {
						var music = document.getElementById("music");
						music.src = "http://12Me21.github.io/BGM/BGM"+songnum+".mp3"
						music.play()
					} else {
						textarea.value+="Out of range(BGMPLAY:1)\n";
					}
				} else if (checkCommand(lastline,"CLS")) {
					textarea.value=""
				} else if (checkCommand(lastline,"GOTO")) {
					var lbl = lastline.split("@")[lastline.split("@").length -1];
					if (checkUrl(lbl)==true) {
						window.location.href = lbl;
					} else {
						textarea.value+="Invalid label(GOTO:1)\n";
					}
				} else if (checkCommand(lastline,"BGMSTOP")) {
					var music = document.getElementById("music");
					music.src = ""
					music.play()
				} else {	
					textarea.value+="Syntax error\n";
				}
				textarea.value+="OK\n";
				do{
					if (textarea.clientHeight != textarea.scrollHeight){
						textarea.value = textarea.value.substring(textarea.value.indexOf("\n") + 1);
					}
				}
				while (textarea.clientHeight != textarea.scrollHeight);
			}
			function checkUrl(url) {
				var xhr = new XMLHttpRequest();
				xhr.open('HEAD', url, false);
				xhr.send();
				return (xhr.status == "200");
			}
		
			function setCursor(input, location) {					
				input.focus()
				var range = input.createTextRange();
				range.moveEnd('character', location);
				range.moveStart('character', location);
				range.select();
			}
			
			function checkCommand(line,command) {
				return (line.substr(0,command.length).toUpperCase()==command)
			}
		</script>
	</head>
	<body style="background-color:#333">
		<textarea autofocus onkeyup="Javascript: if (event.keyCode==13) readLine();" spellcheck="false" autocorrect="false"></textarea>
		<p class="SmileBASIC">Commands:<br>BGMPLAY song<br>BGMSTOP<br>CLS<br>GOTO @page</p>
		<audio id="music"></audio>
	</body>
</html>
