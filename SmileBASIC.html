<html>
	<head>
		<title>SmileBASIC</title>
		<link rel="icon" type="image/png" sizes="16x16" href="./resources/SBicon.png">
		<link rel="stylesheet" href="./main.css"</link>
		<style>
			textarea {
				margin: 0;
				border: 0;
				padding: 0;
				height: 240px;
				width: 400px;
				font-size: 8px;
				line-height: 8px;
				background-color: #111;
				color: #FFF;
				font-family: "SmileBASIC", monospace;
				overflow: hidden;  
				resize: none;
				outline: none;
				/*pointer-events: none;*/
			}
		</style>
		<script>
			document.createElement('audio');
			
			document.addEventListener('DOMContentLoaded', function() {
				var textarea = document.getElementsByTagName("textarea")[0];
				textarea.value = "SMILEBASIC ver -0.3.2\n(C)2011-2015 SmileBoom Co.Ltd.\n9150922752 bytes free\n";
				setSelectionRange(textarea,textarea.value.length,textarea.value.length);
			}, false);
			
			function readLine() {
				var textarea = document.getElementsByTagName("textarea")[0];
				var lastline = textarea.value.split("\n")[textarea.value.split("\n").length - 2];
				if (lastline.substr(0,7).toUpperCase()=="BGMPLAY"){
					var command = parseInt(lastline.split(" ")[lastline.split(" ").length -1]);
					var songnum=" ";
					if (command>=0 && command<=9) {
						songnum=" "+command;
					} else {
						songnum=command;
					}
					if (command>=0 && command <=42) {
						var music = document.getElementById("music");
						music.src = "http://12Me21.github.io/BGM/BGM"+songnum+".mp3"
						music.play()
					} else {
						textarea.value+="Out of range(BGMPLAY:1)\n";
					}
				} else if (lastline.substr(0,7).toUpperCase()=="CLS") {
					textarea.value=""
				} else if (lastline.substr(0,4).toUpperCase()=="GOTO") {
					var lbl = lastline.split("@")[lastline.split("@").length -1];
					if (checkUrl(lbl)==true) {
						window.location.href = lbl;
					} else {
						textarea.value+="Invalid label(GOTO:1)\n";
					}
				} else if (lastline.substr(0,7).toUpperCase()=="BGMSTOP") {
					
				} else {	
					textarea.value+="Syntax error\n";
				}
				textarea.value+="OK\n";
				do{
					if (textarea.clientHeight != textarea.scrollHeight){
						textarea.value = textarea.value.substring(textarea.value.indexOf("\n") + 1);
					}
				}
				while (textarea.clientHeight != textarea.scrollHeight);
			}
			function checkUrl(url) {
				var xhr = new XMLHttpRequest();
				xhr.open('HEAD', url, false);
				xhr.send();
				return (xhr.status == "200");
			}
		
			function setSelectionRange(input, selectionStart, selectionEnd) {					
				input.focus()
				var range = input.createTextRange();
				range.collapse(true);
				range.moveEnd('character', selectionEnd);
				range.moveStart('character', selectionStart);
				range.select();
			}
		</script>
	</head>
	<body style="background-color:#333">
		<textarea autofocus onkeyup="Javascript: if (event.keyCode==13) readLine();" onload="codeAddress();" spellcheck="false" autocorrect="false"></textarea>
		<p class="SmileBASIC">Commands:<br>BGMPLAY song<br>ACLS<br>GOTO @page</p>
		<audio id="music"></audio>
	</body>
</html>
