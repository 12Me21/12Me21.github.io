<html>
	<head>
		<title>SmileMusic</title>
		<link rel="icon" type="image/png" sizes="16x16" href="./resources/sbOSTicon.png">
		<link rel="stylesheet" href="./main.css"</link>
		<style>
			textarea {
				margin: 0;
				border: 0;
				padding: 0;
				height: 240px;
				width: 400px;
				font-size: 8px;
				line-height: 8px;
				background-color: #111;
				color: #FFF;
				font-family: "SmileBASIC", monospace;
				overflow: hidden;  
				resize: none;
				outline: none;
				/*pointer-events: none;*/
			}
		</style>
	<script>
		function readLine() {
			var textarea = document.getElementsByTagName("textarea")[0];
			var lastline = textarea.value.split("\n")[textarea.value.split("\n").length - 2];
			if (lastline.substr(0,7)=="BGMPLAY"){
				var command = parseInt(lastline.split(" ")[lastline.split(" ").length -1]);
				var songnum=" ";
				if (command>=0 && command<=9) {
					songnum=" "+command;
				} else {
					songnum=command;
				}
				if (songnum>=0 && songnum <=42) {
					//audio.stop(); Y U NO WORK?
					audio = new Audio("http://12Me21.github.io/BGM/BGM"+songnum+".mp3");
				audio.play();
				} else {
					textarea.value+="Out of range(BGMPLAY:1)\n";
				}
			} else if (lastline.substr(0,7)=="BGMSTOP") {
				//audio.stop(); :(
				location.reload(true);
			} else if (lastline.substr(0,4)=="GOTO") {
				var lbl = lastline.split("@")[lastline.split("@").length -1];
				if (checkUrl(lbl)==true) {
					window.location.href = lbl;
				} else {
					textarea.value+="Invalid label(GOTO:1)\n";
				}
			} else {	
				textarea.value+="Syntax error\n";
			}
			textarea.value+="OK\n";
			do{
				if (textarea.clientHeight != textarea.scrollHeight){
					textarea.value = textarea.value.substring(textarea.value.indexOf("\n") + 1);
				}
			}
			while (textarea.clientHeight != textarea.scrollHeight);
		}
		function checkUrl(url) {
			var xhr = new XMLHttpRequest();
			xhr.open('HEAD', url, false);
			xhr.send();
			if (xhr.status != "200") { //don't be optimistic
				return false;
			} else {
				return true;
			}
		}
	</script>
</head>
<body style="background-color:#333">
		<textarea autofocus onkeyup="Javascript: if (event.keyCode==13) readLine();" spellcheck="false" autocorrect="false">SMILEMUSIC 0.2.1
(C)2016-2016 SmileBoom Co.Ltd.
Sound composed by JOEDOWN
</textarea>
</body>
</html>
