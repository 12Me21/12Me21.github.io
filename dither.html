<html>
	<head>
		<title>16 bit SB image ditherer</title>
		<link rel="icon" type="image/png" sizes="16x16" href="./resources/inactive.png">
		<script>
			window.onload=function(){
				var fileBrowse=document.getElementById("imageUpload")
				fileBrowse.onchange=function(){
					var reader=new FileReader()
					reader.onload=function(){
						var z=new Image()
						z.onload=function(){
							canvas.width=z.width 
							canvas.height=z.height
							c2d.drawImage(z,0,0)
							convertImage()
							alert("finished")
						}
						z.src=this.result
					}
					reader.readAsDataURL(this.files[0])
				}
				var canvas=document.getElementById("canvas")
				var c2d=canvas.getContext("2d")
				
				function convertImage() {
					var data=c2d.getImageData(0,0,canvas.width,canvas.height)
					var err=new Array(3)
					var width=canvas.width*4;
					//Floydâ€“Steinberg dithering is pretty popular, so it's probably good.
					for(var i=0;i<data.data.length;i+=4){
						for(j=0;j<3;j++){
							err[j]=(data.data[i+j]&0b00000111)/16
							data.data[i+j]&=0b11111000
							data.data[i+      4+j]+=err[j]*7
							data.data[i+width-4+j]+=err[j]*3
							data.data[i+width  +j]+=err[j]*5
							data.data[i+width+4+j]+=err[j]
						}
					}
					c2d.putImageData(data,0,0)
				}
			}
		</script>
	</head>
	<body>
		<input type="file" id="imageUpload">
		<hr>
		<canvas id="canvas" ></canvas>
	</body>
</html>
