<!DOCTYPE html>
<html>
  <head>
		<title>Fake Inactive Avatar Creator</title>
    <link rel="icon" type="image/png" sizes="16x16" href="./resources/inactive.png">
    <script>
      window.onload=function(){
      var z; //best variable name (c) Trinitro 2016
      var dark=document.getElementById("dark");
      var fileBrowse=document.getElementById("imageUpload");
      fileBrowse.onchange=function(){
        var reader=new FileReader();
        reader.onload=function(){loadImage(this.result)};
		  reader.readAsDataURL(this.files[0]);
      };
      var canvas=document.getElementById("canvas");
      var c2d=canvas.getContext("2d");
      
      function loadImage(source) {
        z=new Image();
        z.onload=function(){
          canvas.width=z.width;
          canvas.height=z.height;
          c2d.drawImage(z,0,0);
          convertImage();
        };
        z.src=source;
      }
      
      function convertImage() {
        canvas.hidden=true;
		  var bg=dark.checked?51:211;
        var data=c2d.getImageData(0,0,canvas.width,canvas.height);
		  var d=data.data;
        for (var x=0;x<d.length;x+=4) {
          sum=d[x]*.3+d[x+1]*.6+d[x+2]*.1;
          for(var i=0;i<3;i++)d[x+i]=sum;
        }
        c2d.putImageData(data,0,0);
        c2d.fillStyle="rgba("+bg+","+bg+","+bg+",0.6)";
        c2d.fillRect(0,0,canvas.width,canvas.height);
        canvas.hidden=false;
      }
     }
    </script>
  </head>
  <body>
    <input type="checkbox" id="dark">dark theme
    <input type="file" id="imageUpload">
    <hr>
    <canvas id="canvas"></canvas>
  </body>
</html>
