OPTION STRICT
OPTION DEFINT

DIM UNDO[0]
VAR UNDOPOS=0

COMMON DEF CANREDO(STATE)
 RETURN UNDOPOS<LEN(UNDO)-LEN(STATE)
END

COMMON DEF CANUNDO(STATE)
 RETURN UNDOPOS>0
END

COMMON DEF UNDOPUSH STATE
 WHILE UNDOPOS<LEN(UNDO)-LEN(STATE)
  EAT POP(UNDO)
 WEND
 COPY UNDO,LEN(UNDO),STATE
 UNDOPOS=LEN(UNDO)-LEN(STATE)
END

COMMON DEF UNDOPOP STATE
 IF CANUNDO(STATE) THEN
  DEC UNDOPOS,LEN(STATE)
  COPY STATE,UNDO,UNDOPOS,LEN(STATE)
 ENDIF
END

COMMON DEF REDOPOP STATE
 IF CANREDO(STATE) THEN
  INC UNDOPOS,LEN(STATE)
  COPY STATE,UNDO,UNDOPOS,LEN(STATE)
 ENDIF
END

COMMON DEF UNDORESET
 FREE OUT UNDO
 UNDOPOS=0
END

DEF EAT SAND END
DEF FREE()
 DIM ARRAY[0]
 RETURN ARRAY
END

