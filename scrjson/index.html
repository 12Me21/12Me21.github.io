<canvas id="upper" style="border:1px solid red;" width=400 height=240> </canvas>
<canvas id="lower" style="border:1px solid red;" width=320 height=240> </canvas>
<hr>
<textarea id="json">{"screens":[ {"sprites":[ { "u":64,"v":48,"x":192,"y":108,"c":-1}],"bgs":[ {"d":[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,41,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,41,11,41,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,41,11,11,11,41,41,41,38,38,38,38,38,38,38,38,38,38,38,38,38,41,41,38,38,38,38,38,41,11,11,11,11,11,11,41,38,38,38,38,38,38,38,38,38,38,38,38,11,11,41,41,38,38,38,41,11,11,1,1,11,11,41,38,38,38,38,38,38,38,38,38,38,38,38,11,11,11,11,41,41,41,11,11,1,1,1,1,11,41,38,38,38,38,38,38,38,38,38,38,38,38,11,11,11,11,11,11,11,11,11,1,1,1,1,11,41,38,38,38,38,38,38,38,38,38,38,38,38,11,11,11,11,11,11,11,11,11,11,1,1,11,11,41,38,38,38,38,38,38,38,38,38,38,38,38,11,11,11,11,11,11,6,11,11,11,11,11,11,11,41,38,38,38,38,38,38,38,38,38,38,38,38,11,11,11,11,11,6,38,6,6,11,11,11,11,41,6,38,38,38,38,38,38,38,38,38,38,38,38,11,11,11,11,11,38,38,38,38,6,11,11,11,11,41,38,38,38,38,38,38,38,38,38,38,38,38,11,11,11,11,11,38,38,38,38,11,11,11,11,11,41,38,38,38,38,38,38,38,38,38,38,38,38,11,11,11,11,6,38,38,38,38,11,11,11,11,11,11,41,38,38,38,38,38,38,38,38,38,38,38,11,11,11,11,11,38,38,38,11,11,11,11,11,11,41,6,38,38,38,38,38,38,38,38,38,38,38],"w":27,"h":18,"x":16,"y":32,"z":40,"c":-1},{"d":[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,0,0,0,17,17,17,0,0,0,0,0,0,0,0,0,0,0,0,0,17,17,0,0,0,0,0,17,0,35,36,37,37,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,17,0,0,0,17,35,13,14,14,36,37,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,17,17,0,13,14,14,14,14,37,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,14,14,14,14,15,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,14,14,15,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,51,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0],"w":27,"h":18,"x":16,"y":32,"z":30,"c":-1},{"d":[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,18,0,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,18,0,0,0,18,18,18,0,0,0,0,0,0,0,0,0,0,0,0,0,18,18,0,0,0,0,0,18,0,3,4,5,5,0,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,18,18,0,0,0,18,3,35,36,36,4,5,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,18,18,18,0,35,36,36,36,36,5,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,35,36,36,36,36,37,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,35,36,36,37,0,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,18,0,0,0,0,0,0,0,0,0,0,0,0,0],"w":27,"h":18,"x":16,"y":32,"z":-20,"c":-1}],"chars":[]},{"sprites":[ { "u":496,"v":40,"h":8,"x":160,"y":24,"c":-1},{ "u":240,"v":48,"x":-100,"y":-100,"z":-25}],"bgs":[ {"d":[ 19,43,21,10,21,54,1,45,10,47,0,10,10,9,21,10,10,12,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,53,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,19,44,43,42,47,46,45,50,49,48,26,54,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"w":20,"h":16,"y":-8,"c":-1}],"chars":[ { "c":32,"b":8},{ "x":1,"c":50,"b":8},{ "x":2,"c":55,"b":9},{ "x":3,"c":52,"b":9},{ "x":4,"c":57,"b":8},{ "x":5,"c":57,"b":8},{ "x":6,"c":32,"b":9},{ "x":7,"c":50,"b":9},{ "x":8,"c":55,"b":8},{ "x":9,"c":56,"b":8},{ "x":10,"c":32,"b":9},{ "x":11,"c":49,"b":9},{ "x":12,"c":32,"b":8},{ "x":13,"c":49,"b":8},{ "x":14,"c":57,"b":9},{ "x":15,"c":52,"b":9},{ "x":16,"c":57,"b":8},{ "x":17,"c":57,"b":8},{ "x":18,"c":57,"b":9},{ "x":19,"c":54,"b":9},{ "x":22,"c":57,"b":9},{ "x":23,"c":57,"b":9},{ "x":24,"c":57,"b":8},{ "x":25,"c":57,"b":8},{ "x":26,"c":50,"b":9},{ "x":27,"c":56,"b":9},{ "x":28,"c":56,"b":8},{ "x":29,"c":55,"b":8},{ "x":30,"c":57,"b":9},{ "x":31,"c":57,"b":9},{ "x":32,"c":57,"b":8},{ "x":33,"c":57,"b":8},{ "x":34,"c":50,"b":9},{ "x":35,"c":48,"b":9},{ "x":36,"c":32,"b":8},{ "x":37,"c":54,"b":8},{ "x":8,"y":20,"c":32,"b":8},{ "x":9,"y":20,"c":50,"b":8},{ "y":24,"c":32,"b":8},{ "x":1,"y":24,"c":49,"b":8},{ "x":2,"y":24,"c":32,"b":9},{ "x":3,"y":24,"c":49,"b":9},{ "x":4,"y":24,"c":57,"b":8},{ "x":5,"y":24,"c":57,"b":8},{ "x":6,"y":24,"c":57,"b":9},{ "x":7,"y":24,"c":57,"b":9},{ "x":8,"y":24,"c":57,"b":8},{ "x":9,"y":24,"c":57,"b":8},{ "x":10,"y":24,"c":57,"b":9},{ "x":11,"y":24,"c":57,"b":9},{ "x":12,"y":24,"c":57,"b":8},{ "x":13,"y":24,"c":57,"b":8},{ "x":14,"y":24,"c":57,"b":9},{ "x":15,"y":24,"c":57,"b":9},{ "x":16,"y":24,"c":57,"b":8},{ "x":17,"y":24,"c":57,"b":8},{ "x":18,"y":24,"c":57,"b":9},{ "x":19,"y":24,"c":57,"b":9},{ "x":20,"y":24,"c":57,"b":8},{ "x":21,"y":24,"c":57,"b":8},{ "x":22,"y":24,"c":32,"b":9},{ "x":23,"y":24,"c":49,"b":9},{ "x":24,"y":24,"c":32,"b":8},{ "x":25,"y":24,"c":49,"b":8}]}]}</textarea><br>
<button onclick="go()">Generate Screenshot</button>
<div style="display:none;">
<img id="source" src="TILES.PNG">
<img id="font" src="FONT.PNG">
</div>

<script>
var go=function(){
var screens=[document.getElementById("upper"),document.getElementById("lower")];
var c2ds=[screens[0].getContext("2d"),screens[1].getContext("2d")];
var image = document.getElementById("source");
var font = document.getElementById("font");
var scr=JSON.parse(document.getElementById("json").value)

c2ds[1].fillStyle="#808080";
c2ds[1].fillRect(0,0,400,240);

for(var j=0;j<240-48;j+=32){
	c2ds[1].fillStyle="#FFFFFF";
	c2ds[1].fillRect(0,j+8,320,16);
	for(var i=0;i<320;i+=16){
		box(c2ds[1],i,j+8,16,16,"#C1C0C0")
	}
}
c2ds[1].fillStyle="#FFFFFF";
c2ds[1].fillRect(0,j+8,320,16);
for(var i=0;i<320;i+=16){
	box(c2ds[1],i,j+8,16,16,"red")
}

function box(c2d,x,y,w,h,col){
	c2d.beginPath();
	c2d.strokeStyle=col; //ok so we're using css units...
	c2d.lineWidth="1"; //wait, just 1? not 1 pixel? ok...
	c2d.rect(x+0.5,y+0.5,w-1,h-1) //finally, this is it right?
	c2d.stroke(); //nope. P.S. you forgot to do beginPath() lol
}

var tcols=Array(16)
for(var i=0;i<16;i++){
	var br=i%2?255:128
	tcols[i]="rgba("+(i&2?br:0)+","+(i&4?br:0)+","+(i&8?br:0)+","+(i==0?0:1)+")"
}

for(var screen=0;screen<=1;screen++){
	var bgs=scr.screens[screen].bgs
	var sprites=scr.screens[screen].sprites
	var chrs=scr.screens[screen].chars
	for(z=1024;z>=-256;z--){
		for(var layer=0;layer<bgs.length;layer++){
			if((bgs[layer].z||0) == z){
			var w=bgs[layer].w
			var h=bgs[layer].h
			var data=bgs[layer].d
			var x=bgs[layer].x||0
			var y=bgs[layer].y||0
			for(var i=0;i<w*h;i++){
				var tile=data[i]
				if(tile!=0){
					var dx=-x+i%w*16
					var dy=-y+Math.floor(i/w)*16
					var tx=tile%32*16
					var ty=Math.floor(tile/32)*16
					c2ds[screen].drawImage(image,tx,ty,16,16,dx,dy,16,16)
				}
			}
			}
		}
		for(var sprite=0;sprite<sprites.length;sprite++){
			if((sprites[sprite].z||0) == z){
				var u=sprites[sprite].u
				var v=sprites[sprite].v
				var w=sprites[sprite].w||16
				var h=sprites[sprite].h||16
				var x=sprites[sprite].x
				var y=sprites[sprite].y
				c2ds[screen].drawImage(image,u,v,w,h,x,y,w,h)
			}
		}
		for(var chr=0;chr<chrs.length;chr++){
			if((chrs[chr].z||0) == z){
				var x=(chrs[chr].x||0)*8
				var y=(chrs[chr].y||0)*8
				var c=chrs[chr].c||0
				var f=chrs[chr].f||15
				var b=chrs[chr].b||0
				var u=c%64*8
				var v=Math.floor(c/64)*8
				c2ds[1].fillStyle=tcols[b];
				c2ds[1].fillRect(x,y,8,8);
				c2ds[screen].drawImage(font,u,v,8,8,x,y,8,8)
			}
		}
	}
}

}

</script>
